{% extends 'admin/dashboard.html' %}
{% load static %}
{% block content %}
    <section class="content">
        <!-- THIS DISPLAYS THE MESSAGE -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-success alert-dismissible">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
        <!-- Small boxes (Stat box) -->
        <div class="box box-primary">
            <div class="box-header">
              <i class="ion ion-clipboard"></i>
              <h3 class="box-title">Product List</h3>
            </div>

            <div class="box-body">
                <div style="overflow-x: auto;">
                    <table class="table table-striped" style="table-layout: fixed; width: 100%;">
                        <thead>
                          <tr>
                            <th style="width: 8%;">ID</th>
                            <th style="width: 10%;">Image</th>  <!-- Added Image Column -->
                            <th style="width: 15%;">Product Name</th>
                            <th style="width: 12%;">Category</th>
                            <th style="width: 10%;">Price</th>
                            <th style="width: 10%;">Stock Qty</th>
                            <th style="width: 20%;">Action</th>
                          </tr>
                        </thead>
                        <tbody>
                            {% for product in products %}
                              <tr>
                                <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ product.id }}</td>
                                <td>  <!-- Added Image Cell -->
                                    {% if product.image %}
                                        <img src="{{ product.image.url }}" alt="{{ product.name }}"
                                             style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                                    {% else %}
                                        <div style="width: 50px; height: 50px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                                            <span style="color: #999; font-size: 10px;">No Image</span>
                                        </div>
                                    {% endif %}
                                </td>
                                <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ product.name }}</td>
                                <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ product.category }}</td>
                                <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${{ product.price }}</td>
                                <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                    <span class="{% if product.stock_qty <= 5 %}text-danger{% elif product.stock_qty <= 20 %}text-warning{% else %}text-success{% endif %}">
                                        {{ product.stock_qty }}
                                    </span>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                                        <a href="/manager/products/edit/{{ product.id }}/" class="btn btn-primary btn-sm">
                                            <span class="glyphicon glyphicon-pencil"></span> Edit
                                        </a>
                                        <a href="/manager/products/view/{{ product.id }}/" class="btn btn-success btn-sm">
                                            <span class="glyphicon glyphicon-eye-open"></span> View
                                        </a>
                                        <a href="/manager/products/delete/{{ product.id }}/" class="btn btn-danger btn-sm" methods="get">
                                            <span class="glyphicon glyphicon-trash"></span> Delete
                                        </a>
                                    </div>
                                </td>
                              </tr>
                            {% endfor %}
                        </tbody>
                      </table>
                </div>
            </div>

            <div class="box-footer clearfix no-border">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <p style="margin: 0;">Item Count: {{count_item}}</p>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <p style="margin: 0;">Page {{ products.number }} of {{ products.paginator.num_pages }}</p>
                        <ul class="pagination" style="margin: 0; display: flex; align-items: center;">
                            {% if products.has_previous %}
                                <li><a href="?page=1" style="color:white;background-color:green">&laquo; first</a></li>
                                <li><a href="?page={{ products.previous_page_number }}" style="color:white;background-color:green">previous</a> </li>
                            {% else %}
                                <li><a style="color:white;background-color:gray">first</a> </li>
                            {% endif %}

                            {% for i in products.paginator.page_range %}
                                {% if products.number == i %}
                                    <li><a href="#" style="color:white;background-color: blue;">{{ i }}</a></li>
                                {% else %}
                                    <li><a href="?page={{ i }}" style="color:black;">{{ i }}</a></li>
                                {% endif %}
                            {% endfor %}

                            {% if products.has_next %}
                                <li><a href="?page={{ products.next_page_number }}" style="color:white;background-color:green">next</a></li>
                                <li><a href="?page={{ products.paginator.num_pages }}" style="color:white;background-color:green">last &raquo;</a></li>
                            {% else %}
                                <li><a style="color:white;background-color:gray">last</a> </li>
                            {% endif %}
                        </ul>
                    </div>
                    <a href="/manager/products/show/" class="btn btn-default pull-right text-bold text-blue" role="button" style="margin: 0;">
                        <icon class="fa fa-plus"></icon> Add Product
                    </a>
                </div>
            </div>
        </div>
    </section>
{% endblock content %}